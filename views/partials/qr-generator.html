<section class="pt-28 pb-20 min-h-screen">
  <div class="max-w-5xl mx-auto px-6">

    <div class="mb-10 animate-fade-up">
      <span class="tag">Tools</span>
      <h2 class="font-display text-3xl sm:text-4xl font-bold tracking-tight mt-4">
        Branded QR Generator
      </h2>
      <p class="text-[#5c5c5c] text-base leading-relaxed mt-3 max-w-2xl">
        Create custom QR codes with your logo, colours, and branding. Uses high error correction for logo compatibility.
      </p>
    </div>

    <div class="grid lg:grid-cols-2 gap-10 reveal">
      <!-- Controls -->
      <div>
        <div class="card p-8 space-y-7">
          <!-- URL Input -->
          <div>
            <label for="qr-url" class="block font-mono text-[11px] text-[#9a9a9a] mb-2.5">URL *</label>
            <input
              class="w-full bg-[#faf9f7] border border-black/[0.08] rounded-lg px-4 py-3.5 text-sm text-[#1a1a1a] placeholder-[#c5c5c5] transition-colors focus:border-[#2563eb] focus:outline-none"
              placeholder="https://example.com"
              type="url" id="qr-url" value="https://example.com"
            />
          </div>

          <!-- Logo Upload -->
          <div>
            <label class="block font-mono text-[11px] text-[#9a9a9a] mb-2.5">Logo (optional)</label>
            <div class="flex gap-3 items-center">
              <label class="flex-1 cursor-pointer">
                <div class="flex items-center justify-center px-4 py-3.5 bg-[#faf9f7] border border-dashed border-black/[0.12] rounded-lg hover:border-[#2563eb] hover:bg-[#faf9f7]/80 transition-all">
                  <i class="fa-solid fa-cloud-arrow-up text-[#9a9a9a] text-sm mr-2.5"></i>
                  <span class="text-[#5c5c5c] text-sm" id="logo-label">Upload logo</span>
                </div>
                <input type="file" accept="image/*" id="logo-input" class="hidden" />
              </label>
              <div id="logo-preview-wrap" class="hidden flex items-center gap-2">
                <img id="logo-preview" src="" alt="Logo" class="w-10 h-10 rounded-lg object-cover border border-black/[0.08]" />
                <button id="clear-logo" class="p-1.5 text-[#9a9a9a] hover:text-red-500 transition-colors text-xs">
                  <i class="fa-solid fa-xmark"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Colours -->
          <div>
            <label class="block font-mono text-[11px] text-[#9a9a9a] mb-2.5">Colours</label>
            <div class="grid grid-cols-2 gap-5">
              <div>
                <span class="block text-xs text-[#5c5c5c] mb-2">Foreground</span>
                <div class="flex items-center gap-3">
                  <label class="relative cursor-pointer group">
                    <div id="fg-swatch" class="w-11 h-11 rounded-xl border-2 border-black/[0.08] group-hover:border-[#2563eb] transition-colors shadow-sm" style="background: #000000;"></div>
                    <input type="color" id="fg-color" value="#000000" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                  </label>
                  <input type="text" id="fg-hex" value="#000000"
                    class="flex-1 bg-[#faf9f7] border border-black/[0.08] rounded-lg px-3 py-2.5 text-sm text-[#1a1a1a] focus:border-[#2563eb] focus:outline-none transition-colors" />
                </div>
              </div>
              <div>
                <span class="block text-xs text-[#5c5c5c] mb-2">Background</span>
                <div class="flex items-center gap-3">
                  <label class="relative cursor-pointer group">
                    <div id="bg-swatch" class="w-11 h-11 rounded-xl border-2 border-black/[0.08] group-hover:border-[#2563eb] transition-colors shadow-sm" style="background: #ffffff;"></div>
                    <input type="color" id="bg-color" value="#ffffff" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer" />
                  </label>
                  <input type="text" id="bg-hex" value="#ffffff"
                    class="flex-1 bg-[#faf9f7] border border-black/[0.08] rounded-lg px-3 py-2.5 text-sm text-[#1a1a1a] focus:border-[#2563eb] focus:outline-none transition-colors" />
                </div>
              </div>
            </div>
          </div>

          <!-- Logo Options (hidden until logo uploaded) -->
          <div id="logo-options" class="hidden space-y-5">
            <div>
              <label class="block font-mono text-[11px] text-[#9a9a9a] mb-2.5">
                Logo Size: <span id="logo-size-label">20</span>%
              </label>
              <input type="range" id="logo-size" min="15" max="30" value="20"
                class="w-full h-1.5 bg-black/[0.06] rounded-lg appearance-none cursor-pointer accent-[#2563eb]" />
            </div>
            <div class="flex items-center justify-between">
              <label class="font-mono text-[11px] text-[#9a9a9a]">Logo padding</label>
              <button id="logo-padding-toggle" class="relative w-11 h-6 rounded-full bg-[#2563eb] transition-colors">
                <span id="logo-padding-dot" class="absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform translate-x-5"></span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Preview -->
      <div>
        <div class="card p-8 flex flex-col items-center">
          <!-- Error -->
          <div id="qr-error" class="hidden w-full mb-4 p-3 rounded-lg text-sm text-red-600" style="background: rgba(239,68,68,0.06); border: 1px solid rgba(239,68,68,0.15);"></div>

          <!-- QR Preview -->
          <div class="p-8 bg-white rounded-xl border border-black/[0.06] shadow-sm">
            <canvas id="qr-canvas" width="300" height="300" class="rounded block"></canvas>
          </div>

          <!-- Download -->
          <div class="mt-6 w-full flex flex-col items-center gap-3">
            <button id="download-qr" class="inline-flex items-center gap-2 px-6 py-2.5 bg-[#1a1a1a] text-white text-sm font-medium rounded-lg hover:bg-[#333] transition-all hover:shadow-md">
              <i class="fa-solid fa-download text-xs"></i> Download PNG
            </button>
            <p class="text-[#9a9a9a] text-[10px] text-center font-mono">
              High error correction (H) &middot; PNG format
            </p>
          </div>
        </div>
      </div>
    </div>

  </div>
</section>

<!-- qrcode-generator library by Kazuhiko Arase (MIT License) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcode-generator/1.4.4/qrcode.min.js"></script>

<script>
(function() {
  const canvas = document.getElementById('qr-canvas');
  const ctx = canvas.getContext('2d');
  let logoImage = null, logoPadding = true;

  function draw() {
    const url = document.getElementById('qr-url').value;
    const fg = document.getElementById('fg-color').value;
    const bg = document.getElementById('bg-color').value;
    const logoSz = parseInt(document.getElementById('logo-size').value);
    const errEl = document.getElementById('qr-error');
    errEl.classList.add('hidden');
    if (!url) return;
    try {
      // Use qrcode-generator library: typeNumber=0 (auto), errorCorrectionLevel='H' (high)
      const qr = qrcode(0, 'H');
      qr.addData(url);
      qr.make();

      const moduleCount = qr.getModuleCount();
      const sz = 300;
      canvas.width = sz; canvas.height = sz;
      ctx.fillStyle = bg; ctx.fillRect(0, 0, sz, sz);
      const msz = sz / moduleCount;
      const logoArea = (sz * logoSz) / 100;
      const ls = (sz - logoArea) / 2, le = ls + logoArea;
      ctx.fillStyle = fg;
      for (let r = 0; r < moduleCount; r++) {
        for (let c = 0; c < moduleCount; c++) {
          if (qr.isDark(r, c)) {
            const px = c * msz, py = r * msz;
            if (logoImage) {
              const cx = px + msz/2, cy = py + msz/2;
              if (cx > ls && cx < le && cy > ls && cy < le) continue;
            }
            ctx.fillRect(px, py, msz, msz);
          }
        }
      }
      if (logoImage) {
        const img = new Image();
        img.onload = () => {
          if (logoPadding) { ctx.fillStyle = bg; ctx.fillRect(ls-6, ls-6, logoArea+12, logoArea+12); }
          ctx.drawImage(img, ls, ls, logoArea, logoArea);
        };
        img.src = logoImage;
      }
    } catch(e) {
      errEl.textContent = 'Error: ' + e.message;
      errEl.classList.remove('hidden');
    }
  }

  // Sync color swatches with inputs
  function updateSwatches() {
    document.getElementById('fg-swatch').style.background = document.getElementById('fg-color').value;
    document.getElementById('bg-swatch').style.background = document.getElementById('bg-color').value;
  }

  ['qr-url','fg-color','bg-color','logo-size'].forEach(id => {
    document.getElementById(id).addEventListener('input', () => {
      if (id === 'fg-color') document.getElementById('fg-hex').value = document.getElementById('fg-color').value;
      if (id === 'bg-color') document.getElementById('bg-hex').value = document.getElementById('bg-color').value;
      if (id === 'logo-size') document.getElementById('logo-size-label').textContent = document.getElementById('logo-size').value;
      updateSwatches();
      draw();
    });
  });
  document.getElementById('fg-hex').addEventListener('input', function() {
    if (/^#[0-9a-f]{6}$/i.test(this.value)) { document.getElementById('fg-color').value = this.value; updateSwatches(); draw(); }
  });
  document.getElementById('bg-hex').addEventListener('input', function() {
    if (/^#[0-9a-f]{6}$/i.test(this.value)) { document.getElementById('bg-color').value = this.value; updateSwatches(); draw(); }
  });

  document.getElementById('logo-input').addEventListener('change', function(e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (ev) => {
        logoImage = ev.target.result;
        document.getElementById('logo-preview').src = logoImage;
        document.getElementById('logo-preview-wrap').classList.remove('hidden');
        document.getElementById('logo-options').classList.remove('hidden');
        document.getElementById('logo-label').textContent = 'Change logo';
        draw();
      };
      reader.readAsDataURL(file);
    }
  });
  document.getElementById('clear-logo').addEventListener('click', () => {
    logoImage = null;
    document.getElementById('logo-input').value = '';
    document.getElementById('logo-preview-wrap').classList.add('hidden');
    document.getElementById('logo-options').classList.add('hidden');
    document.getElementById('logo-label').textContent = 'Upload logo';
    draw();
  });

  document.getElementById('logo-padding-toggle').addEventListener('click', () => {
    logoPadding = !logoPadding;
    const toggle = document.getElementById('logo-padding-toggle');
    const dot = document.getElementById('logo-padding-dot');
    toggle.className = 'relative w-11 h-6 rounded-full transition-colors ' + (logoPadding ? 'bg-[#2563eb]' : 'bg-black/[0.12]');
    dot.className = 'absolute top-1 left-1 w-4 h-4 bg-white rounded-full transition-transform ' + (logoPadding ? 'translate-x-5' : '');
    draw();
  });

  document.getElementById('download-qr').addEventListener('click', () => {
    const link = document.createElement('a');
    link.download = 'branded-qr-code.png';
    link.href = canvas.toDataURL('image/png');
    link.click();
  });

  setTimeout(draw, 100);
})();
</script>
